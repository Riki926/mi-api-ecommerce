<div class="row">
    <div class="col-md-8">
        <h2>‚ö° Productos en Tiempo Real</h2>
        <div id="products-container">
            {{#each products}}
            <div class="card mb-3" data-product-id="{{this._id}}">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            {{#if this.thumbnails}}
                            <img src="{{this.thumbnails.0}}" class="img-fluid rounded" alt="{{this.title}}">
                            {{else}}
                            <img src="https://via.placeholder.com/150x100/6c757d/ffffff?text=Sin+Imagen" class="img-fluid rounded" alt="Sin imagen">
                            {{/if}}
                        </div>
                        <div class="col-md-9">
                            <h5 class="card-title">{{this.title}}</h5>
                            <p class="card-text">{{this.description}}</p>
                            <p class="card-text"><strong>${{this.price}}</strong></p>
                            <p class="card-text">Stock: {{this.stock}} | Categor√≠a: {{this.category}}</p>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct('{{this._id}}')">üóëÔ∏è Eliminar</button>
                            <button class="btn btn-success btn-sm ms-2" onclick="addToCart('{{this._id}}')">üõí Agregar al Carrito</button>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>‚ûï Agregar Producto</h3>
            </div>
            <div class="card-body">
                <form id="add-product-form">
                    <div class="mb-3">
                        <label for="title" class="form-label">T√≠tulo</label>
                        <input type="text" class="form-control" id="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Descripci√≥n</label>
                        <textarea class="form-control" id="description" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Precio ($)</label>
                        <input type="number" class="form-control" id="price" step="0.01" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label for="stock" class="form-label">Stock</label>
                        <input type="number" class="form-control" id="stock" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label for="category" class="form-label">Categor√≠a</label>
                        <select class="form-control" id="category" required>
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="electronics">Electr√≥nicos</option>
                            <option value="clothing">Ropa</option>
                            <option value="home">Hogar</option>
                            <option value="books">Libros</option>
                            <option value="sports">Deportes</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">‚ú® Agregar Producto</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
const socket = io();

socket.on('updateProducts', (products) => {
    const container = document.getElementById('products-container');
    container.innerHTML = '';
    
    products.forEach(product => {
        const productDiv = document.createElement('div');
        productDiv.className = 'card mb-3';
        productDiv.setAttribute('data-product-id', product._id);
        productDiv.innerHTML = `
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <img src="${product.thumbnails ? product.thumbnails[0] : 'https://via.placeholder.com/150x100/6c757d/ffffff?text=Sin+Imagen'}" 
                             class="img-fluid rounded" alt="${product.title}">
                    </div>
                    <div class="col-md-9">
                        <h5 class="card-title">${product.title}</h5>
                        <p class="card-text">${product.description}</p>
                        <p class="card-text"><strong>$${product.price}</strong></p>
                        <p class="card-text">Stock: ${product.stock} | Categor√≠a: ${product.category}</p>
                        <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product._id}')">üóëÔ∏è Eliminar</button>
                        <button class="btn btn-success btn-sm ms-2" onclick="addToCart('${product._id}')">üõí Agregar al Carrito</button>
                    </div>
                </div>
            </div>
        `;
        container.appendChild(productDiv);
    });
});

document.getElementById('add-product-form').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const productData = {
        title: document.getElementById('title').value,
        description: document.getElementById('description').value,
        price: parseFloat(document.getElementById('price').value),
        stock: parseInt(document.getElementById('stock').value),
        category: document.getElementById('category').value,
        status: true
    };
    
    socket.emit('addProduct', productData);
    
    // Limpiar formulario
    document.getElementById('add-product-form').reset();
    
    // Mostrar mensaje de √©xito
    alert('‚úÖ Producto agregado exitosamente');
});

function deleteProduct(productId) {
    if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
        socket.emit('deleteProduct', productId);
        alert('üóëÔ∏è Producto eliminado');
    }
}

function addToCart(productId) {
    fetch(`/api/v1/carts/1/products/${productId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert('üõí Producto agregado al carrito');
        } else {
            alert('‚ùå Error al agregar al carrito');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('‚ùå Error de conexi√≥n');
    });
}
</script>
