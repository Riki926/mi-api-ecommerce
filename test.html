<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de API E-commerce</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 0 20px; 
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .error {
            color: red;
            background: #ffe6e6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e6ffe6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üõçÔ∏è Prueba de API E-commerce</h1>

    <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #007bff;">
        <strong>üí° Consejos:</strong>
        <ul style="margin: 10px 0; padding-left: 20px;">
            <li>Aseg√∫rate de que tu API est√© ejecut√°ndose en <code>http://localhost:8080</code></li>
            <li>Usa el bot√≥n "Probar Conexi√≥n" para verificar que la API est√© disponible</li>
            <li>Los botones se deshabilitan durante las peticiones para evitar m√∫ltiples clics</li>
        </ul>
        <button onclick="testConnection()" style="background: #28a745;">üîó Probar Conexi√≥n</button>
    </div>
    
    <h2>üì¶ Productos</h2>
    <button onclick="getProducts()">GET - Obtener Productos</button>
    <button onclick="createProduct()">POST - Crear Producto</button>
    <button onclick="getProduct()">GET - Obtener Producto ID 1</button>
    
    <h2>üõí Carritos</h2>
    <button onclick="createCart()">POST - Crear Carrito</button>
    <button onclick="getCart()">GET - Obtener Carrito ID 1</button>
    <button onclick="addToCart()">POST - Agregar Producto al Carrito</button>
    
    <div id="result">
        <h3>Resultado:</h3>
        <pre id="output">Haz clic en un bot√≥n para probar la API...</pre>
    </div>

    <script>
        const API_URL = 'http://localhost:8080';
        
        // Funci√≥n para mostrar resultados
        function showResult(data, isError = false, isLoading = false) {
            const output = document.getElementById('output');
            if (isLoading) {
                output.className = 'loading';
                output.textContent = data;
            } else {
            output.className = isError ? 'error' : 'success';
            output.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
            }
        }

        // Funci√≥n para deshabilitar todos los botones
        function setButtonsDisabled(disabled) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => button.disabled = disabled);
        }

        // Funci√≥n para hacer peticiones
        async function makeRequest(url, options = {}) {
            try {
                console.log('Haciendo petici√≥n a:', url);
                setButtonsDisabled(true);
                showResult('Cargando...', false, true);

                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                let data;
                const contentType = response.headers.get('content-type');

                if (response.status === 204) {
                    data = 'Operaci√≥n exitosa (sin contenido)';
                } else if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = await response.text();
                }
                
                if (!response.ok) {
                    throw new Error(data.error || data.message || `Error ${response.status}: ${response.statusText}`);
                }

                showResult(data);
            } catch (error) {
                console.error('Error en la petici√≥n:', error);
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showResult('Error: No se puede conectar al servidor. Aseg√∫rate de que la API est√© ejecut√°ndose en http://localhost:8080', true);
                } else {
                showResult(`Error: ${error.message}`, true);
                }
            } finally {
                setButtonsDisabled(false);
            }
        }

        // Productos
        function getProducts() {
            makeRequest(`${API_URL}/api/products`);
        }

        function createProduct() {
            const product = {
                title: "Smartphone Samsung",
                description: "Galaxy S21 Ultra 5G",
                code: "SAM001",
                price: 999.99,
                stock: 10,
                category: "Electr√≥nicos"
            };

            // Validaci√≥n b√°sica
            if (!product.title || !product.code || product.price <= 0) {
                showResult('Error: Datos del producto inv√°lidos', true);
                return;
            }

            makeRequest(`${API_URL}/api/products`, {
                method: 'POST',
                body: JSON.stringify(product)
            });
        }

        function getProduct() {
            makeRequest(`${API_URL}/api/products/1`);
        }

        // Carritos
        function createCart() {
            makeRequest(`${API_URL}/api/carts`, {
                method: 'POST'
            });
        }

        function getCart() {
            makeRequest(`${API_URL}/api/carts/1`);
        }

        function addToCart() {
            const cartId = 1;
            const productId = 1;
            const quantity = 1;

            // Validaci√≥n b√°sica
            if (!cartId || !productId || quantity <= 0) {
                showResult('Error: IDs de carrito y producto deben ser v√°lidos, cantidad debe ser mayor a 0', true);
                return;
            }

            makeRequest(`${API_URL}/api/carts/${cartId}/product/${productId}`, {
                method: 'POST',
                body: JSON.stringify({ quantity: quantity })
            });
        }

        // Funci√≥n para probar conexi√≥n con la API
        async function testConnection() {
            try {
                setButtonsDisabled(true);
                showResult('Probando conexi√≥n...', false, true);

                const response = await fetch(`${API_URL}/health`, {
                    method: 'GET'
                });

                if (response.ok) {
                    showResult('‚úÖ Conexi√≥n exitosa: La API est√° respondiendo correctamente');
                } else {
                    showResult(`‚ö†Ô∏è Conexi√≥n con problemas: ${response.status} ${response.statusText}`, true);
                }
            } catch (error) {
                showResult('‚ùå Error de conexi√≥n: No se puede conectar al servidor', true);
            } finally {
                setButtonsDisabled(false);
            }
        }

        // Inicializaci√≥n
            console.log('P√°gina cargada. API URL:', API_URL);
    </script>
</body>
</html>